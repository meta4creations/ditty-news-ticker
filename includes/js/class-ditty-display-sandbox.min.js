!function($){"use strict";var t={displayType:null,dittyUniqId:null},i=function(i,s){this.elmt=i,this.settings=$.extend({},t,$.ditty_display_sandbox.defaults,s),this.$elmt=$(i),this.$form=this.$elmt.find(".ditty-editor-options"),this._init()};i.prototype={_init:function(){var t=this;this.settings.editor.initFields(this.$elmt),displayOptions=this.settings.editor.ditty.$elmt["ditty_"+this.displayType]("options"),this.displayOptions=$.extend({},displayOptions),this.displayTitle=this.$optionsTitle.val(),this.$importExportUpdate.on("click",{self:this},this._importUpdate),this.settings.editor.$elmt.on("ditty_editor_add_drafts",{self:this},this._addDrafts),this.settings.editor.$elmt.on("ditty_editor_save_drafts",{self:this},this._saveDrafts),this.$form.on("submit",{self:this},this._submitForm),this.$back.on("click",{self:this},this._backClick),this.$elmt.on("change",'input[type="text"], input[type="number"]',{self:this},this._textfieldListeners),this.$form.on("click",'input[type="radio"]',{self:this},this._radioListeners),this.$form.on("click",'input[type="checkbox"]',{self:this},this._checkboxListeners),this.$form.on("change","select",{self:this},this._selectListeners),this.$form.on("ditty_field_clone_update",{self:this},this._cloneListeners),setTimeout((function(){t.trigger("init",[t])}),1)},_showDisplayList:function(){this.settings.editor.$panels.ditty_slider("options","transition","slideRight"),this.settings.editor.$panels.ditty_slider("showSlideById","displays")},_checkUpdates:function(){this.$form.serialize()!==this.initData?(this.settings.editor.addUpdate("displaySettings",this.displayId),this.settings.editor.delayedSubmitEnable()):this.settings.editor.removeUpdate("displaySettings",this.displayId)},_addDrafts:function(t){var i=t.data.self;i.$form.serialize()!==i.initData&&i.$form.trigger("submit")},_saveDrafts:function(t){var i=t.data.self;i.$form.serialize()!==i.initData&&(i.afterUpdateAction="save",i.$form.trigger("submit"))},_backClick:function(t){t.preventDefault();var i=t.data.self;i.$form.serialize()===i.initData?i._showDisplayList():(i.afterUpdateAction="return",i.$form.trigger("submit"))},_submitForm:function(t){t.preventDefault();var i=t.data.self;i.settings.editor.updateStart();var s={action:"ditty_editor_display_update",display_id:i.displayId,draft_values:i.settings.editor.getDraftValues(),security:dittyVars.security};i.$form.ajaxSubmit({url:dittyVars.ajaxurl,type:"post",dataType:"json",data:s,success:function(t){i.initData=i.$form.serialize(),t.draft_id&&t.draft_label&&(i.displayTitle=t.draft_label,i.$editorDisplayTitle.text(t.draft_label),dittyDraftDisplayUpdate(i,t.draft_id,"label",t.draft_label)),t.draft_id&&t.draft_settings&&(i.displayOptions=t.draft_settings,dittyDraftDisplayUpdate(i,t.draft_id,"settings",t.draft_settings)),t.draft_settings_json&&i.$importExportField.length&&i.$importExportField.val(t.draft_settings_json),i.settings.editor.updateStop(),i.settings.editor.delayedSubmitDisable(),"return"===i.afterUpdateAction&&i._showDisplayList(),"save"===i.afterUpdateAction&&i.settings.editor.saveDitty(),i.afterUpdateAction=""}})},_importUpdate:function(t){t.preventDefault()},_cloneListeners:function(t,i,s){var e=t.data.self;$(t.target);e.settings.editor.ditty.options(s,i)},_textfieldListeners:function(t){var i=t.data.self,s=$(t.target),e=s.attr("name"),a=s.parents(".ditty-input--spacing__group, .ditty-input--radius__group");if(a.length){var n="",d={};a.find("input").each((function(){e=$(this).attr("name"),n=(n=e.split("["))[0];var t=e.match(/\[(.*)\]/);d[t[1]]=$(this).val()})),i.settings.editor.ditty.options(n,d)}else i.settings.editor.ditty.options(e,s.val());i._checkUpdates()},_radioListeners:function(t){var i=t.data.self,s=$(t.target),e=s.val(),a=s.attr("name");i.settings.editor.ditty.options(a,e),i._checkUpdates()},_checkboxListeners:function(t){var i=t.data.self,s=$(t.target),e=!!s.is(":checked")&&$(this).val(),a=s.attr("name");i.settings.editor.ditty.options(a,e),i._checkUpdates()},_selectListeners:function(t){var i=t.data.self,s=$(t.target),e=s.val(),a=s.attr("name");i.settings.editor.ditty.options(a,e),i._checkUpdates()},_options:function(t){return this.settings[t]},trigger:function(t,i){var s=[this.settings];i&&(s=i),this.$elmt.trigger("ditty_display_sandbox_"+t,s),"function"==typeof this.settings[t]&&this.settings[t].apply(this.$elmt,s)},options:function(i,s){if("object"==typeof i)this.settings=$.extend({},t,$.ditty_display_sandbox.defaults,i);else{if("string"!=typeof i)return this.settings;if(void 0===s)return this.settings[i];this.settings[i]=s}this.trigger("options_update")},destroy:function(){this.trigger("destroy",[this]),this.$importExportUpdate.off("click",{this:this},this._importUpdate),this.settings.editor.$elmt.off("ditty_editor_add_drafts",{self:this},this._addDrafts),this.settings.editor.$elmt.off("ditty_editor_save_drafts",{self:this},this._saveDrafts),this.$form.off("submit",{this:this},this._submitForm),this.$back.off("click",{this:this},this._cancel_click),this.$elmt.off("change",'input[type="text"], input[type="number"]',{self:this},this._textfieldListeners),this.$form.off("click",'input[type="radio"]',{self:this},this._radioListeners),this.$form.off("click",'input[type="checkbox"]',{self:this},this._checkboxListeners),this.$form.off("change","select",{self:this},this._selectListeners),this.$form.off("ditty_field_clone_update",{self:this},this._cloneListeners),this.elmt._ditty_display_sandbox=null}},$.fn.ditty_display_sandbox=function(t){var s,e=arguments,a=!1;if(void 0===t||"object"==typeof t)return this.each((function(){this._ditty_display_sandbox||(this._ditty_display_sandbox=new i(this,t))}));if("string"==typeof t){if(this.each((function(){var i=this._ditty_display_sandbox;if(!i)throw new Error("No Ditty_Display_Sandbox applied to this element.");"function"==typeof i[t]&&"_"!==t[0]?s=i[t].apply(i,[].slice.call(e,1)):a=!0})),a)throw new Error('No method "'+t+'" in Ditty_Display_Sandbox.');return void 0!==s?s:this}},$.ditty_display_sandbox={},$.ditty_display_sandbox.defaults=t}(jQuery);