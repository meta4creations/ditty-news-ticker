/* global ditty_news_ticker_vars:true */
/* global CodeMirror:true */
/* //global ajaxurl:true */

// @codekit-append 'partials/admin-tabs.js';
// @codekit-append 'partials/admin-ticks.js';
// @codekit-append 'partials/admin-layouts.js';

jQuery( document ).ready( function($) {

	// Setup strict mode
	(function() {

    "use strict";
		
		/**
		 * Variation hover
		 * @since   3.0
		 */
		$('.dnt-tab__panel__variation').hover(
		  function () {
			  var $label = $(this).children('.dnt-tab__panel__variation__label');
			  $label.css('display', 'flex');
		    $label.stop().animate( {
		    	marginLeft: 0,
		    	opacity: 1
		    }, 500, 'easeOutQuint', function() {
		    	// Animation complete.
		    });
		  }, 
		  function () {
			  var $label = $(this).children('.dnt-tab__panel__variation__label');
		    $label.stop().animate( {
		    	marginLeft: '-100%',
		    	opacity: 0
		    }, 500, 'easeOutQuint', function() {
		    	$label.css('display', 'none');
		    });
		  }
		);
		
		
		/**
		 * Setup the variations
		 * @since   3.0
		 */
		function activate_variation( $link ) {
			
			if( !$link.hasClass('active') ) {
				
				// Reset the tabs and variations
				$('.dnt-tab__panel__variation').removeClass('active');
				$('.dnt-tab__panel__input--variation').hide();
				
				// Activate the current tab
				$link.addClass('active');
				
				// Activate the variation
				var $panel = $link.parents( '.dnt-tab__panel' );
				var $variation = $panel.find( '.dnt-tab__panel__input--variation[data-id="'+$link.data('variation')+'"]' );
				$variation.show();
				
				// Refresh codemirror
				//var cm = $variation.find('.dnt-layout-structure-textarea').next('.CodeMirror')[0].CodeMirror;
				//cm.refresh();
			}
		}
		$('.dnt-tab__panel__variation').click( function(e) {
			e.preventDefault();
			activate_variation( $(this) );
		});
		
		
		/**
		 * Setup the tabs
		 * @since   3.0
		 */
		function activate_tab( $tab ) {
			
			var $container = $tab.parents( '.dnt-tabs' );
			var $panel = $container.find( '.dnt-tab__panel[data-id="'+$tab.data('panel')+'"]' );
			
			if( $tab.hasClass('active') ) {
				
				// Deactivate the current tab
				if( 'toggle' === $container.data('tab-type') ) {
					$tab.removeClass('active');
					$panel.hide();	
				}
				
			} else {
				
				// Reset the tabs and panels
				$('.dnt-tab').removeClass('active');
				$('.dnt-tab__panel').hide();
				
				// Activate the current tab
				$tab.addClass('active');
				$panel.show();
				
				// Actiave variations, if any
				if( $panel.find('.dnt-tab__panel__variations').length ) {
					if( $panel.find('.dnt-tab__panel__variation.active').length ) {
						activate_variation( $panel.find('.dnt-tab__panel__variation.active') );
					} else {
						activate_variation( $panel.find('.dnt-tab__panel__variation:first-child') );
					}
				}
			}
		}
		$('.dnt-tab').click( function(e) {
			e.preventDefault();
			activate_tab( $(this) );	
		});
		if( $('.dnt-tab').length ) {
			//activate_tab( $('.dnt-tab:first-child').children('a') );
		}

	}());

});

jQuery( document ).ready( function($) {
	
/*
	function tick_edit_containers_close() {
		
		$('.dnt-tick-list__edit').each( function(index) {
			
		});
		
	}
*/
	
	$('body').on( 'click', '.dnt-tick-list__element--type', function(e) {
		
		e.preventDefault();
		
		var $edit_container = $(this).siblings('.dnt-tick-list__edit'),
				$edit_contents = $edit_container.children('.dnt-tick-list__edit__contents'),
				edit_content = ditty_news_ticker_vars.edit_types,
				content_h = $edit_contents.height();
	
		if( $(this).hasClass('active') ) {	
			$(this).removeClass('active');
			
			$edit_contents.stop().animate( {
				marginTop: '-'+content_h+'px'
			}, 1000, 'easeInOutQuint', function() {
				$edit_contents.empty();
			});
			
		} else {
			
			$(this).addClass('active');
			
			if( content_h === 0 ) {
				$edit_contents.hide();
				$edit_contents.html( edit_content );
				content_h = $edit_contents.height();
				$edit_contents.stop().css('marginTop', '-'+content_h+'px');
				$edit_contents.show();
			}

			$edit_contents.stop().animate( {
				marginTop: 0
			}, 1000, 'easeInOutQuint', function() {
				// Animation complete.
			});
		}
	});
	
	
	$('body').on( 'click', '.dnt-tick-list__element--template', function(e) {
		
		e.preventDefault();
		
		var $edit_container = $(this).siblings('.dnt-tick-list__edit'),
				$edit_contents = $edit_container.children('.dnt-tick-list__edit__contents'),
				edit_content = ditty_news_ticker_vars.edit_templates,
				content_h = $edit_contents.height();
	
		if( $(this).hasClass('active') ) {		
			$(this).removeClass('active');
			
			$edit_contents.stop().animate( {
				marginTop: '-'+content_h+'px'
			}, 1000, 'easeInOutQuint', function() {
				$edit_contents.empty();
			});
			
		} else {
			
			$(this).addClass('active');
			
			if( content_h === 0 ) {
				$edit_contents.hide();
				$edit_contents.html( edit_content );
				content_h = $edit_contents.height();
				$edit_contents.stop().css('marginTop', '-'+content_h+'px');
				$edit_contents.show();
			}

			$edit_contents.stop().animate( {
				marginTop: 0
			}, 1000, 'easeInOutQuint', function() {
				// Animation complete.
			});
		}
	});
	
	
	$('.dnt-tick-type-option').click( function(e){
		
		e.preventDefault();
		
		var $item = $(this).parents('.dnt-ticks__item'),
				type = $(this).data('type');
		
		var data = {
			action		: 'dnt_admin_initialize_tick_type',
			type			: type,
			security	: ditty_news_ticker_vars.security
		};
    
    $.post( ditty_news_ticker_vars.ajaxurl, data, function( response ) {
			
			if( response ) {
				$item.html( response );
			}

		} );

	});

});


jQuery( document ).ready( function($) {

	// Setup strict mode
	(function() {

    "use strict";
    
    /**
     * Destroy CodeMirror
     * @since 	3.0
     */
/*
    function destroy_structure_codemirror() {
	    
	    $('#dnt-layout-structure').find('.dnt-layout-structure-textarea').each( function() {
		    
		    var $textarea = $(this);
		    
		    if( $textarea[0].CodeMirror ) {
			    console.log('yes');
		    } else {
			    console.log('no');
		    }
		    
		    //console.log( $textarea[0].CodeMirror() );
		    
		   // CodeMirror.toTextArea( $textarea[0] );
	    });  
    }
*/
  
    /**
     * Initialize CodeMirror
     * @since 	3.0
     */
/*
    function initialize_structure_codemirror( $textarea ) {
	    
    	var editor = CodeMirror.fromTextArea($textarea[0], {
		    lineNumbers: true,
		    lineWrapping: true,
		    tabSize: 2,
		    indentWithTabs: true,
		    mode: 'htmlmixed',
		    theme: 'blackboard'
		  });
		  editor.setSize( false, '100%' );
    }
*/
    
    $('.dnt-layout-structure-textarea').each( function() {
	    
	    var $textarea = $(this);

    	var editor = CodeMirror.fromTextArea( $textarea[0], {
		    lineNumbers: true,
		    lineWrapping: true,
		    tabSize: 2,
		    indentWithTabs: true,
		    mode: 'htmlmixed',
		    theme: 'blackboard'
		  });
		  editor.setSize( false, false );
    });
    
    $('.dnt-layout-style-textarea').each( function() {
	    
	    var $textarea = $(this);
	    
    	var editor = CodeMirror.fromTextArea( $textarea[0], {
		    lineNumbers: true,
		    lineWrapping: true,
		    tabSize: 2,
		    indentWithTabs: true,
		    mode: 'css',
		    theme: 'blackboard'
		  });
		  editor.setSize( false, false );
    });

	}());

});